/*!
 CraftMultiSelect.js
 0.0.1 
*/
(function(){function e(e,t){var n=e.css({display:"none"}),r=Element.make("div",{id:"container_"+n.id}).addClass("containerStyle"),i=Element.make("div",{id:"selectable_"+n.id}).appendTo(r).addClass("selectableDivStyle"),s=Element.make("ul",{id:"content-list"}).appendTo(i).addClass("ulStyle"),o=Element.make("div",{id:"selection_"+n.id}).appendTo(r).addClass("selectionDivStyle"),u=Element.make("ul",{id:"content-selected-list"}).appendTo(o).addClass("ulStyle"),a=Element.createFragment(),f=function(e,t,n){e.getChildren().pluck("data-group-item").contains(t)?e.getChildren().select(function(e){return e.get("data-group-item")==t}).reverse()[0].insert({after:n}):e.insert(n),n.removeClass("liItemGroupStyleOver")},l=function(e,t){e.getChildren().pluck("data-group-item").contains(t)||e.getChildren().each(function(e){e.get("data-group")==t&&e.remove()})},c=0,h=function(e,t,n){var r=Element.make("li",{id:e.value,"data-index":c++}).appendTo(n?n:s).addClass("liStyle").set("item",e);t&&r.set("data-group-item",t).addClass("liItemGroupStyle"),Element.make("span",{innerHTML:e.innerHTML}).appendTo(r)},p=function(e){if("OPTION"==e.nodeName)e.selected?h(e,null,u):h(e);else if("OPTGROUP"==e.nodeName){var t=e.get("label"),n=Element.make("li",{"data-index":c++,"data-group":t}).appendTo(s).toggleClass("liGroupStyle liStyle");Element.make("span",{innerHTML:e.get("label")}).appendTo(n),e.getChildren().each(function(e){e.selected?(u.getChildren().pluck("data-group").contains(t)||u.insert(n.cloneNode(!0).set("data-group",t)),h(e,t,u)):h(e,t)}),l(s,t)}},d=function(e,n,r){e.listen("mouseover","li",function(n,r){r.get("data-group")?t.selectableOptgroup&&(r.toggleClass("liGroupStyleOver"),e.getChildren().each(function(e){r.get("data-group")==e.get("data-group-item")&&e.addClass("liItemGroupStyleOver")})):r.addClass("liItemGroupStyleOver")}),e.listen("mouseout","li",function(n,r){t.selectableOptgroup&&r.get("data-group")?(r.removeClass("liGroupStyleOver"),e.getChildren().each(function(e){r.get("data-group")==e.get("data-group-item")&&e.removeClass("liItemGroupStyleOver")})):r.removeClass("liItemGroupStyleOver")}),e.listen("click","li",function(i,s){if(s.get("data-group"))t.selectableOptgroup&&(n.getChildren().pluck("data-group").contains(s.get("data-group"))||n.insert(s),e.getChildren().each(function(e){s.get("data-group")==e.get("data-group-item")&&(f(n,s.get("data-group"),e),e.get("item").selected=r)}),l(e,s.get("data-group")));else{s.get("item").selected=r;if(s.get("data-group-item")){var o=s.get("data-group-item"),u=e.getChildren().select(function(e){return e.get("data-group")==o})[0];n.getChildren().pluck("data-group").contains(o)||n.insert(u.cloneNode(!0).set("data-group",o)),f(n,o,s),l(e,o)}else n.getChildren().isEmpty()?n.insert(s):n.getChildren()[0].get("data-index")>s.get("data-index")?n.getChildren()[0].insert({before:s}):n.getChildren().fold(function(e,t){return t.get("data-index")>s.get("data-index")?e:t}).insert({after:s})}s.removeClass("liItemGroupStyleOver"),s.removeClass("liGroupStyleOver")})};n.getChildren().each(p),d(s,u,!0),d(u,s),a.appendChild(r),n.insert({after:a})}Element.extend({multiSelect:function(t){var n=this;return t||(t={selectableOptgroup:!0}),n.nodeName=="SELECT"&&e(n,t),n}})})();