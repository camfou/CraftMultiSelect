/*!
 CraftMultiSelect.js
 0.0.1 
*/
(function(){function t(t,n){e=$(t);var r=e.css({display:"none"}),i=Elements.create("div").addClass("containerStyle"),s=Elements.create("div").addClass("selectableDivStyle").appendTo(i),o=Elements.create("ul").addClass("ulStyle").appendTo(s),u=Elements.create("div").addClass("selectionDivStyle").appendTo(i),a=Elements.create("ul").addClass("ulStyle").appendTo(u),f=Elements.fragment(),l=function(e,t){e.children().select(function(e){return $(e).data("group-item")==t}).isEmpty()&&e.children().each(function(e){$(e).data("groupName")==t&&$(e).remove()})},c=function(e,t){if(!e.children().isEmpty()){var n=$(e.children()[0]);parseInt(n.data("index"),10)>parseInt($(t).data("index"),10)?n.insertBefore(t):$(e.children().fold(function(e,n){return parseInt($(n).data("index"),10)>parseInt($(t).data("index"),10)?e:n})).insertAfter(t)}else e.append(t)},h=0,p=function(e,t){var n=Elements.create("li",{id:e.value}).addClass("liStyle").data("index",h++);return t&&n.data("group-item",t).addClass("liItemGroupStyle"),Elements.create("span",{innerHTML:e.innerHTML}).appendTo(n),n},d=function(e){if("OPTION"==e.nodeName)e.selected?a.append(p(e)):o.append(p(e));else if("OPTGROUP"==e.nodeName){var t=e.label,n=Elements.create("li").toggleClass("liGroupStyle liStyle").data("index",h++).data("groupName",t).appendTo(o);n.append(Elements.create("span",{innerHTML:e.label})),$(e).children().each(function(e){e.selected?(a.children().select(function(e){return $(e).data("groupName")==t}).isEmpty()&&a.append(n.clone(!0).data("groupName",t).data("index",n.data("index"))),a.append(p(e,t))):o.append(p(e,t))}),l(o,t)}},v=function(t,r,i){t.listen("mouseover","li",function(e){var r=$(this);r.data("groupName")?n.selectableOptgroup&&(r.addClass("liGroupStyleOver"),t.children().each(function(e){r.data("groupName")==$(e).data("group-item")&&$(e).addClass("liItemGroupStyleOver")})):r.addClass("liItemGroupStyleOver")}),t.listen("mouseout","li",function(e){var r=$(this);n.selectableOptgroup&&r.data("groupName")?(r.removeClass("liGroupStyleOver"),t.children().each(function(e){r.data("groupName")==$(e).data("group-item")&&$(e).removeClass("liItemGroupStyleOver")})):r.removeClass("liItemGroupStyleOver")}),t.listen("click","li",function(s){var o=$(this),u;if(u=o.data("groupName"))n.selectableOptgroup&&(r.children().select(function(e){return $(e).data("groupName")==u}).isEmpty()&&c(r,this),t.children().each(function(t){u==$(t).data("group-item")&&(c(r,t),$(t).data("groupName")||($("#"+e[0].id+" option[value="+t.id+"]")[0].selected=i),$(t).removeClass("liItemGroupStyleOver"))}),l(t,u));else{$("#"+e[0].id+" option[value="+this.id+"]")[0].selected=i;if(u=o.data("group-item")){var a=$(t.children().select(function(e){return $(e).data("groupName")==u})[0]);r.children().select(function(e){return $(e).data("groupName")==u}).isEmpty()&&c(r,a.clone(!0).data("groupName",u).data("index",a.data("index"))),c(r,this),l(t,u)}else c(r,o)}o.removeClass("liItemGroupStyleOver").removeClass("liGroupStyleOver")})},m=function(e){var t=Elements.create("input",{type:"text"}).addClass("filterStyle");t.listen("keyup",function(){var t=this.value;e.children().each(function(e){e.innerHTML.match(t)?$(e).css({display:"block"}):$(e).data("groupName")||$(e).css({display:"none"})})}),e.insertBefore(t)};r.children().each(d),n.filters&&(m(o),m(a)),v(o,a,!0),v(a,o),f.appendChild(i[0]),$(r).insertAfter(f)}Elements.implement({multiSelect:function(e){var n=this;return e||(e={selectableOptgroup:!0,filters:!1}),n[0].nodeName=="SELECT"&&t(n[0],e),n}});var e})();