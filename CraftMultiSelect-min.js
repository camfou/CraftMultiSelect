/*!
 CraftMultiSelect.js
 0.1.1 
*/
(function(e){function n(n,r){t=e(n);var i=t.css({display:"none"}),s=Elements.create("div").addClass("containerStyle"),o=Elements.create("div").addClass("selectableDivStyle").appendTo(s),u=Elements.create("ul").addClass("ulStyle").appendTo(o),a=Elements.create("div").addClass("selectionDivStyle").appendTo(s),f=Elements.create("ul").addClass("ulStyle").appendTo(a),l=Elements.fragment(),c=function(t,n){t.children().select(function(t){return e(t).data("group-item")==n}).isEmpty()&&t.children().each(function(t){e(t).data("groupName")==n&&e(t).remove()})},h=function(t,n){if(!t.children().isEmpty()){var r=e(t.children()[0]);parseInt(r.data("index"),10)>parseInt(e(n).data("index"),10)?r.insertBefore(n):e(t.children().fold(function(t,r){return parseInt(e(r).data("index"),10)>parseInt(e(n).data("index"),10)?t:r})).insertAfter(n)}else t.append(n)},p=0,d=function(e,t){var n=Elements.create("li",{id:e.value}).addClass("liStyle").data("index",p++);return t&&n.data("group-item",t).addClass("liItemGroupStyle"),Elements.create("span",{innerHTML:e.innerHTML}).appendTo(n),n},v=function(t){if("OPTION"==t.nodeName)t.selected?f.append(d(t)):u.append(d(t));else if("OPTGROUP"==t.nodeName){var n=t.label,r=Elements.create("li").toggleClass("liGroupStyle liStyle").data("index",p++).data("groupName",n).appendTo(u);r.append(Elements.create("span",{innerHTML:t.label})),e(t).children().each(function(t){t.selected?(f.children().select(function(t){return e(t).data("groupName")==n}).isEmpty()&&f.append(r.clone(!0).data("groupName",n).data("index",r.data("index"))),f.append(d(t,n))):u.append(d(t,n))}),c(u,n)}},m=function(n,i,s){n.listen("mouseover","li",function(t){var i=e(this);i.data("groupName")?r.selectableOptgroup&&(i.addClass("liGroupStyleOver"),n.children().each(function(t){i.data("groupName")==e(t).data("group-item")&&e(t).addClass("liItemGroupStyleOver")})):i.addClass("liItemGroupStyleOver")}),n.listen("mouseout","li",function(t){var i=e(this);r.selectableOptgroup&&i.data("groupName")?(i.removeClass("liGroupStyleOver"),n.children().each(function(t){i.data("groupName")==e(t).data("group-item")&&e(t).removeClass("liItemGroupStyleOver")})):i.removeClass("liItemGroupStyleOver")}),n.listen("click","li",function(o){var u=e(this),a;if(a=u.data("groupName"))r.selectableOptgroup&&(i.children().select(function(t){return e(t).data("groupName")==a}).isEmpty()&&h(i,this),n.children().each(function(n){a==e(n).data("group-item")&&(h(i,n),e(n).data("groupName")||(e("#"+t[0].id+" option[value="+n.id+"]")[0].selected=s),e(n).removeClass("liItemGroupStyleOver"))}),c(n,a));else{e("#"+t[0].id+" option[value="+this.id+"]")[0].selected=s;if(a=u.data("group-item")){var f=e(n.children().select(function(t){return e(t).data("groupName")==a})[0]);i.children().select(function(t){return e(t).data("groupName")==a}).isEmpty()&&h(i,f.clone(!0).data("groupName",a).data("index",f.data("index"))),h(i,this),c(n,a)}else h(i,u)}u.removeClass("liItemGroupStyleOver").removeClass("liGroupStyleOver")})},g=function(t){var n=Elements.create("input",{type:"text",placeholder:"Filter"}).addClass("filterStyle");n.listen("keyup",function(){var n=this.value;t.children().each(function(t){t.innerHTML.match(n)?e(t).css({display:"block"}):e(t).data("groupName")||e(t).css({display:"none"})})}),t.insertBefore(n)};i.children().each(v),r.selectableHeader&&u.insertBefore(Elements.from(r.selectableHeader).addClass("headerStyle")),r.selectionHeader&&f.insertBefore(Elements.from(r.selectionHeader).addClass("headerStyle")),r.filters&&(g(u),g(f)),m(u,f,!0),m(f,u),l.appendChild(s[0]),e(i).insertAfter(l)}Elements.implement({multiSelect:function(e){var t=this;return e=e||{},t[0].nodeName=="SELECT"&&n(t[0],e),t}});var t})(Craft);