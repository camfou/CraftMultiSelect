/*!
 CraftMultiSelect.js
 0.0.1 
*/
(function(){function e(e,t){var n=e.css({display:"none"}),r=Element.make("div").addClass("containerStyle"),i=Element.make("div").addClass("selectableDivStyle").appendTo(r),s=Element.make("ul").addClass("ulStyle").appendTo(i),o=Element.make("div").addClass("selectionDivStyle").appendTo(r),u=Element.make("ul").addClass("ulStyle").appendTo(o),a=Element.createFragment(),f=function(e,t){e.getChildren().pluck("data-group-item").contains(t)||e.getChildren().each(function(e){e.get("data-group")==t&&e.remove()})},l=function(e,t){e.getChildren().isEmpty()?e.insert(t):e.getChildren()[0].get("data-index")>t.get("data-index")?e.getChildren()[0].insert({before:t}):e.getChildren().fold(function(e,n){return n.get("data-index")>t.get("data-index")?e:n}).insert({after:t})},c=0,h=function(e,t){var n=Element.make("li",{id:e.value,"data-index":c++,item:e}).addClass("liStyle");return t&&n.set("data-group-item",t).addClass("liItemGroupStyle"),Element.make("span",{innerHTML:e.innerHTML}).appendTo(n),n},p=function(e){if("OPTION"==e.nodeName)e.selected?u.insert(h(e)):s.insert(h(e));else if("OPTGROUP"==e.nodeName){var t=e.get("label"),n=Element.make("li",{"data-index":c++,"data-group":t}).toggleClass("liGroupStyle liStyle").appendTo(s);Element.make("span",{innerHTML:e.get("label")}).appendTo(n),e.getChildren().each(function(e){e.selected?(u.getChildren().pluck("data-group").contains(t)||u.insert(n.cloneNode(!0).set("data-group",t).set("data-index",n.get("data-index"))),u.insert(h(e,t))):s.insert(h(e,t))}),f(s,t)}},d=function(e,n,r){e.listen("mouseover","li",function(n,r){r.get("data-group")?t.selectableOptgroup&&(r.addClass("liGroupStyleOver"),e.getChildren().each(function(e){r.get("data-group")==e.get("data-group-item")&&e.addClass("liItemGroupStyleOver")})):r.addClass("liItemGroupStyleOver")}),e.listen("mouseout","li",function(n,r){t.selectableOptgroup&&r.get("data-group")?(r.removeClass("liGroupStyleOver"),e.getChildren().each(function(e){r.get("data-group")==e.get("data-group-item")&&e.removeClass("liItemGroupStyleOver")})):r.removeClass("liItemGroupStyleOver")}),e.listen("click","li",function(i,s){if(s.get("data-group"))t.selectableOptgroup&&(n.getChildren().pluck("data-group").contains(s.get("data-group"))||l(n,s),e.getChildren().each(function(e){s.get("data-group")==e.get("data-group-item")&&(l(n,e),e.get("item").selected=r,e.removeClass("liItemGroupStyleOver"))}),f(e,s.get("data-group")));else{s.get("item").selected=r;if(s.get("data-group-item")){var o=s.get("data-group-item"),u=e.getChildren().select(function(e){return e.get("data-group")==o})[0];n.getChildren().pluck("data-group").contains(o)||l(n,u.cloneNode(!0).set("data-group",o).set("data-index",u.get("data-index"))),l(n,s),f(e,o)}else l(n,s)}s.removeClass("liItemGroupStyleOver").removeClass("liGroupStyleOver")})};n.getChildren().each(p),d(s,u,!0),d(u,s),a.appendChild(r),n.insert({after:a})}Element.extend({multiSelect:function(t){var n=this;return t||(t={selectableOptgroup:!0}),n.nodeName=="SELECT"&&e(n,t),n}})})();