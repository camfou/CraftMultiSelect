/*!
 CraftMultiSelect.js
 0.0.1 
*/
(function(){function e(e,t){e=$(e);var n=e.css({display:"none"}),r=Elements.create("div").addClass("containerStyle"),i=Elements.create("div").addClass("selectableDivStyle").appendTo(r),s=Elements.create("ul").addClass("ulStyle").appendTo(i),o=Elements.create("div").addClass("selectionDivStyle").appendTo(r),u=Elements.create("ul").addClass("ulStyle").appendTo(o),a=Elements.fragment(),f=function(e,t){e.children().select(function(e){return $(e).data("group-item")==t}).isEmpty()&&e.children().each(function(e){$(e).data("groupName")==t&&$(e).remove()})},l=function(e,t){if(!e.children().isEmpty()){var n=$(e.children()[0]);parseInt(n.data("index"),10)>parseInt($(t).data("index"),10)?n.insertBefore(t):$(e.children().fold(function(e,n){return parseInt($(n).data("index"),10)>parseInt($(t).data("index"),10)?e:n})).insertAfter(t)}else e.append(t)},c=0,h=function(e,t){var n=Elements.create("li",{id:e.value}).addClass("liStyle").data("index",c++);return t&&n.data("group-item",t).addClass("liItemGroupStyle"),Elements.create("span",{innerHTML:e.innerHTML}).appendTo(n),n},p=function(e){if("OPTION"==e.nodeName)e.selected?u.append(h(e)):s.append(h(e));else if("OPTGROUP"==e.nodeName){var t=e.label,n=Elements.create("li").toggleClass("liGroupStyle liStyle").data("index",c++).data("groupName",t).appendTo(s);n.append(Elements.create("span",{innerHTML:e.label})),$(e).children().each(function(e){e.selected?(u.children().select(function(e){return $(e).data("groupName")==t}).isEmpty()&&u.append(n.clone(!0).data("groupName",t).data("index",n.data("index"))),u.append(h(e,t))):s.append(h(e,t))}),f(s,t)}},d=function(e,n,r){e.listen("mouseover","li",function(n){var r=$(this);r.data("groupName")?t.selectableOptgroup&&(r.addClass("liGroupStyleOver"),e.children().each(function(e){r.data("groupName")==$(e).data("group-item")&&$(e).addClass("liItemGroupStyleOver")})):r.addClass("liItemGroupStyleOver")}),e.listen("mouseout","li",function(n){var r=$(this);t.selectableOptgroup&&r.data("groupName")?(r.removeClass("liGroupStyleOver"),e.children().each(function(e){r.data("groupName")==$(e).data("group-item")&&$(e).removeClass("liItemGroupStyleOver")})):r.removeClass("liItemGroupStyleOver")}),e.listen("click","li",function(i){var s=$(this),o;if(o=s.data("groupName"))t.selectableOptgroup&&(n.children().select(function(e){return $(e).data("groupName")==o}).isEmpty()&&l(n,this),e.children().each(function(e){o==$(e).data("group-item")&&(l(n,e),$(e).data("groupName")||($("option[value="+e.id+"]")[0].selected=r),$(e).removeClass("liItemGroupStyleOver"))}),f(e,o));else{$("option[value="+this.id+"]")[0].selected=r;if(o=s.data("group-item")){var u=$(e.children().select(function(e){return $(e).data("groupName")==o})[0]);n.children().select(function(e){return $(e).data("groupName")==o}).isEmpty()&&l(n,u.clone(!0).data("groupName",o).data("index",u.data("index"))),l(n,this),f(e,o)}else l(n,s)}s.removeClass("liItemGroupStyleOver").removeClass("liGroupStyleOver")})};n.children().each(p),d(s,u,!0),d(u,s),a.appendChild(r[0]),$(n).insertAfter(a)}Elements.implement({multiSelect:function(t){var n=this;return t||(t={selectableOptgroup:!0}),n[0].nodeName=="SELECT"&&e(n[0],t),n}})})();